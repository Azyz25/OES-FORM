<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
  <link rel="icon" href="OES-logo.svg" type="image/svg+xml" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <style>

    @font-face {
  font-family: 'TheSansPlain';
  src: url('TheSans-Plain.otf') format('opentype');
  font-weight: normal;
  font-style: normal;
}

/* 2) ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®Ø· Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© ÙƒÙ„Ù‡Ø§ */
html, body, * {
  font-family: 'TheSansPlain', sans-serif !important;
}
    /* Ø¹Ø§Ù… */
    body {
      margin: 0;
      display: flex;
      flex-direction: row;
      font-family: 'Arial', sans-serif;
      background: #f4f4f4;
    }
    h2 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 30px;
    }

    /* Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± */
    .sidebar {
      width: 250px;
      background: linear-gradient(to bottom, #212856, #4c5fac);
      border-radius: 25px 0px 0px 25px;
      color: white;
      min-height: 100vh;      
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }
    .sidebar-user {
      text-align: center;
      color: #fff;
      font-size: 16px;
      margin-bottom: 20px;
      margin-top: 20px;
    }
    .sidebar .top {
      flex-grow: 1;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .sidebar li {
      padding: 12px 15px;
      background: #1bc0be;
      border-radius: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 18px;
    }
    .sidebar li.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .sidebar li:hover:not(.disabled) {
      background: #1abc9c;
    }
    .logout-btn {
      background: #e74c3c;
      text-align: center;
      padding: 12px;
      border-radius: 15px;
      cursor: pointer;
      margin-top: auto;
    }
    .logout-btn:hover {
      background: #c0392b;
    }

    /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
    .content {
      flex-grow: 1;
      padding: 30px;
      display: flex;
      flex-direction: column;
    }
    .cards {
      display: flex;
      gap: 30px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    .card {
      flex: 1;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px #ddd;
      text-align: center;
      min-width: 250px;
    }
    canvas {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px #ddd;
    }

    /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }
    th, td {
      padding: 15px;
      border: 1px solid #dee2e6;
      text-align: center;
    }
    th {
      background-color: #1abc9c;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    .radio-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ø§Ù…Ø© */
    .btn {
      background: #1bc0be;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      font-size: 14px;
       display: block;
      margin: 0 auto;   
    }
    .btn:hover {
      background: #67ebe0;
    }

    /* Ø²Ø± Ø§Ù„Ø­ÙØ¸ ÙˆØ¥ØºÙ„Ø§Ù‚ ÙÙŠ Ø§Ù„Ø¯ÙŠØ§Ù„ÙˆÙ‚Ø§Øª */
    .btn-submit {
      background: #28a745;
      color: #fff;
      padding: 10px 20px;
      border: none;
      border-radius: 30px;
      cursor: pointer;
    }
    .btn-close {
      background: #6c757d;
      color: #fff;
      padding: 10px 20px;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      margin-inline-start: 10px;
    }

    /* ÙƒØ±ÙˆØª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† */
    .staff-card {
      background: #fff;
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .staff-card span {
      font-weight: bold;
    }

    /* ØªÙˆØ­ÙŠØ¯ Ø¯ÙŠØ§Ù„ÙˆÙ‚Ø§Øª */
    .dialog-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .dialog-box {
      background: white;
      padding: 30px;
      border-radius: 12px;
      width: 500px;
      max-width: 95vw;
      box-shadow: 0 0 25px rgba(0,0,0,0.2);
      direction: rtl;
      text-align: right;
    }
    .dialog-box input,
    .dialog-box select {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .dialog-actions {
      text-align: left;
      margin-top: 20px;
    }

    /* ØªØ£ÙƒØ¯ Ø¥Ù† staffSection ÙŠØ§Ø®Ø° Ø§Ù„Ø¨Ø§Ø¯ÙŠÙ†Ù‚ Ù†ÙØ³Ù‡ */
    #staffSection {
      flex: 1;
      padding: 0;
    }

    #uploadSection {
    background: #fff;
    border-radius: 25px;
    padding: 30px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    max-width: 800px;
    margin: 40px auto;
  }
  #uploadSection h2 {
    font-size: 24px;
    color: #2c3e50;
    margin-bottom: 20px;
    text-align: center;
  }
  .form-group {
    margin-bottom: 20px;
  }
  .form-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 8px;
    color: #34495e;
  }
  .form-group input,
  .form-group textarea,
  .form-group select,
  .form-group input[type="file"] {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    box-sizing: border-box;
  }
  .slots-config {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
  }
  .slot-group {
    margin-bottom: 15px;
  }

  #currentSection {
    background: #fff;
    border-radius: 40px;
    padding: 30px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    max-width: 1000px;
    margin: 40px auto;
  }
  #currentSection h2 {
    font-size: 24px;
    color: #2c3e50;
    margin-bottom: 20px;
    text-align: center;
  }
  .course-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
  }
  .course-card {
    background: #fafafa;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    width: 300px;
    display: flex;
    flex-direction: column;
  }
  .course-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
  }
  .course-info {
    padding: 15px;
    flex-grow: 1;
  }
  .course-info h3 {
    margin: 0 0 10px;
    color: #2c3e50;
  }
  .course-info p {
    margin: 5px 0;
    font-size: 14px;
    color: #555;
  }
  .course-actions {
    display: flex;
    justify-content: space-between;
    padding: 10px 15px;
    background: #fff;
  }
  .course-actions button {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 18px;
  }
  .course-actions button:hover {
    color: #1abc9c;
  }
 .dialog-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding-top: 40px;
    overflow-y: auto;
    z-index: 9999;
  }
  .dialog-box {
    background: #fff;
    padding: 30px;
    border-radius: 12px;
    width: 500px;
    max-width: 95vw;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 0 20px rgba(0,0,0,0.2);
    direction: rtl;
    text-align: right;
  }

  .dialog-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.dialog-box.large {
  background: #fff;
  border-radius: 12px;
  width: 80vw;           /* 80% Ù…Ù† Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø´Ø© */
  max-width: 800px;
  height: 80vh;          /* 80% Ù…Ù† Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© */
  max-height: 80vh;
  display: flex;
  flex-direction: column;
  padding: 20px;
  box-shadow: 0 0 20px rgba(0,0,0,0.2);
  overflow: hidden;
}

.dialog-box.large h3 {
  margin: 0 0 10px;
}

.dialog-content {
  flex: 1;
  overflow-y: auto;      /* ØªÙ…Ø±ÙŠØ± Ø¹Ù…ÙˆØ¯ÙŠ */
  overflow-x: auto;      /* ØªÙ…Ø±ÙŠØ± Ø£ÙÙ‚ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø© */
  padding-right: 10px;    /* Ù…Ø³Ø§Ø­Ø© Ù„Ø³ÙƒÑ€Ğ¾Ğ» Ø¨Ø§Ø± */
}

.dialog-content p {
  white-space: pre-wrap; /* ÙŠØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ ÙÙˆØ§ØµÙ„ Ø§Ù„Ø£Ø³Ø·Ø± */
  word-wrap: break-word; /* ÙŠÙƒØ³Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶Ø±ÙˆØ±Ø© */
  margin: 0;
}

.dialog-actions {
  text-align: center;
  margin-top: 15px;
}

  .dialog-box h3 {
    margin-top: 0;
    color: #2c3e50;
  }
  .dialog-box .form-group {
    margin-bottom: 15px;
  }
  .dialog-box label {
    font-weight: bold;
    margin-bottom: 5px;
    display: block;
  }
  .dialog-box input,
  .dialog-box textarea {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 6px;
    box-sizing: border-box;
  }
  .dialog-box .actions {
    text-align: left;
    margin-top: 20px;
  }
  .dialog-box .btn-close {
    margin-left: 10px;
  }

  #trainersSection {
  background: #fff;
  border-radius: 40px;
  padding: 30px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  max-width: 1000px;
  margin: 40px auto;
  display: none;
}
#trainersSection h2 {
  font-size: 24px;
  color: #2c3e50;
  margin-bottom: 20px;
  text-align: center;
}
#trainersTable {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}
#trainersTable th, #trainersTable td {
  padding: 12px 8px;
  border: 1px solid #dee2e6;
  text-align: center;
}
#trainersTable th {
  background: #1abc9c;
  color: #fff;
}
#trainersTable tr:nth-child(even) {
  background: #f9f9f9;
}

.sidebar-user{
    color: #ffffff;
    text-align: center;
    margin-bottom: 30px;
    font-size: 22px;
    font-family: 'TheSansPlain' !important;
}

.btn.disabled {
  opacity: 0.5;
  pointer-events: none;
  cursor: default;
}

img.side-logo{
    margin-bottom: 25px;
}
button.bt-s {
    margin-right: 8px !important;
    border: 0 !important;
    border-radius: 10px !important;
    height: 35px !important;
    width: 35px !important;
}
img.side-logo {
    margin-bottom: 25px !important;
}


/* ØªØ¬Ø¹Ù„ overlay ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¹Ù…ÙˆØ¯ÙŠÙ‹Ø§ ÙˆØªØ±ÙØ¹ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ù‚Ù„ÙŠÙ„Ù‹Ø§ Ù„Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø§Ø´Ø© */
.dialog-overlay {
  align-items: flex-start !important;
  padding: 40px 0 !important;
  overflow-y: auto;
}

/* ØªØ­Ø¯Ø¯ Ø£Ù‚ØµÙ‰ Ø§Ø±ØªÙØ§Ø¹ Ù„Ù„ØµÙ†Ø¯ÙˆÙ‚ ÙˆØªÙÙ…ÙƒÙ‘Ù† Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¨Ø¯Ø§Ø®Ù„Ù‡ */
.dialog-box {
  max-height: 80vh !important;
  overflow-y: auto !important;
}


input#heroContactLinkInput {
    border-radius: 25px;
    border: 2px solid #dfdede;
    height: 40px;
}

input#registerLinkInput{

border-radius: 25px;
    border: 2px solid #dfdede;
    height: 40px;

}

/* === Buttons inside staff-card (edit, delete, copy) === */
.staff-card {
  position: relative;    /* Ø­ØªÙ‰ Ù†Ø³ØªØ·ÙŠØ¹ Ø±ÙØ¹ z-index Ø¯Ø§Ø®Ù„ÙŠØ§Ù‹ */
  z-index: 0;
}

.staff-card button {
  background: #1bc0be;
  color: #fff;
  border: none;
  border-radius: 10px;
  width: 35px;
  height: 35px;
  cursor: pointer;
  margin: 0 5px;
  font-size: 16px;
  transition: background 0.2s;
  
  /* Ù†Ø¶ÙŠÙ Ù‡Ø°ÙŠ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡ ÙŠÙ‚Ø¨Ù„ Ø§Ù„Ù†Ù‚Ø±Ø§Øª */
  pointer-events: auto;
  position: relative;
  z-index: 1;
}

.staff-card button:hover {
  background: #17a2b8;
}

  </style>
</head>
<body>
  <div class="sidebar">
    <img class="side-logo" src="./OES-logo2.svg"/>
    <div class="sidebar-user" id="sidebarUser"></div>
    <div class="top">
      <ul>
        <li id="sec1">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</li>
        <li id="sec2">â¬†ï¸ Ø±ÙØ¹ Ø¯ÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</li>
        <li id="sec3">ğŸ“š Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</li>
      <li id="sec6">ğŸŒ ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ·</li>
        <li id="sec4">ğŸ‘¨â€ğŸ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†</li>
        <li id="sec5">âš™ï¸ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØ§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</li>
      </ul>
    </div>
    <div class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</div>
  </div>

  <div class="content">
    <!-- Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
    <div id="dashboardSection">
      <div class="cards">
        <div class="card" id="trainersCard">Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†: ...</div>
        <div class="card" id="coursesCard">Ø§Ù„Ø¯ÙˆØ±Ø§Øª: ...</div>
        <div class="card" id="coursesCardNON">Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø© ...</div>
      </div>
      <canvas id="coursesChart" height="120"></canvas>
      <!-- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ù†Ø³Ø¨Ø© -->
      <canvas id="ratioChart" height="120" style="display:none;"></canvas>
      <canvas id="statusChart" height="8"></canvas>
    </div>

    <!-- ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
    <div id="staffSection" style="display: none;">
      <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØ§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>
      <button class="btn" onclick="showAddUserDialog()">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</button>
      <div id="usersContainer" style="margin-top: 20px;"></div>
    </div>

    <div id="uploadSection" style="display:none;">
  <h2>â¬†ï¸ Ø±ÙØ¹ Ø¯ÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
  <form id="uploadForm">
    <div class="form-group">
      <label for="courseTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯ÙˆØ±Ø©</label>
      <input type="text" id="courseTitle" required>
    </div>
    <div class="form-group">
      <label for="courseDesc">ÙˆØµÙ Ø§Ù„Ø¯ÙˆØ±Ø©</label>
      <textarea id="courseDesc" rows="3" required></textarea>
    </div>
  
    <div id="datesContainer"></div>
    <div class="slots-config">
      <label><input type="checkbox" id="courseMulti"> Ø£ÙƒØ«Ø± Ù…Ù† ÙØªØ±Ø©</label>
      <input type="number" id="slotsCount" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„ÙØªØ±Ø§Øª" min="2" style="width:120px; display:none;">
    </div>
    <div id="slotsContainer">
      <!-- Ù‡Ù†Ø§ ØªØ¶Ø§Ù Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª ÙˆØ§Ù„Ù…Ø¯Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
      <div class="slot-group">
        <label>Ø§Ù„ÙˆÙ‚Øª</label>
        <input type="time" class="slotTime" required>
        <label>Ø§Ù„Ù…Ø¯Ø©</label>
        <input type="text" class="slotDuration" placeholder="Ù…Ø«Ø§Ù„: Ø³Ø§Ø¹ØªÙŠÙ†" required>
      </div>
    </div>
    <div class="form-group">
      <label for="courseCategory">Ø§Ù„ØªØµÙ†ÙŠÙ</label>
      <input type="text" id="courseCategory" placeholder="Ù…Ø«Ø§Ù„: ØªØ·ÙˆÙŠØ± Ø°Ø§ØªÙŠ" required>
    </div>
    <div class="form-group">
      <label for="coursePlace">Ø§Ù„Ù…ÙƒØ§Ù†</label>
      <input type="text" id="coursePlace" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù‚Ø§Ø¹Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© - Ø¬Ø¯Ø©" required>
    </div>
    <div class="form-group">
      <label for="courseTarget">Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</label>
      <input type="text" id="courseTarget" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø¯Ø±Ø§Ø¡ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª" required>
    </div>
   
    <button type="submit" class="btn">Ø±ÙØ¹ Ø§Ù„Ø¯ÙˆØ±Ø©</button>
  </form>
</div>
<div id="currentSection" style="display:none;">
  <h2>ğŸ“š Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
  <div id="currentContainer" class="course-container"></div>
</div>


    <div id="landingSection" style="display:none;">
      <h2>ğŸŒ ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ·</h2>
      <!-- Inputs to edit links -->
      <div style="display:flex; gap:10px; margin-bottom:20px;flex-direction: column;align-items: center;">
        <a>Ø±ÙˆØ§Ø¨Ø· Ø§Ø²Ø±Ø§Ø± ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ· : ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ØŒ Ø§Ø­Ø¬Ø² Ù…Ù‚Ø¹Ø¯Ùƒ Ø§Ù„Ø§Ù†</a>
                <input id="heroContactLinkInput" type="text" class="form-control" placeholder="Ø±Ø§Ø¨Ø· ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ÙÙŠ Ø§Ù„Ù‡ÙŠØ±Ùˆ">
        <input id="registerLinkInput" type="text" class="form-control" placeholder="Ø±Ø§Ø¨Ø· Ø§Ø­Ø¬Ø² Ù…Ù‚Ø¹Ø¯Ùƒ Ø§Ù„Ø¢Ù†">
        <button id="saveLandingLinksBtn" class="btn">Ø­ÙØ¸ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</button>
      </div>
      <!-- Export button -->
      <button id="exportLandingBtn" class="btn">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„</button>
      <div style="overflow-x:auto; margin-top:20px;">
        <table id="landingTable">
          <thead>
            <tr>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
              <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
              <th>Ø§Ù„ÙŠÙˆÙ…</th>
              <th>Ø§Ù„Ù…ØªØµÙØ­</th>
              <th>Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
              <th>Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    
<div id="trainersSection" style="display:none;">
  <h2>ğŸ‘¨â€ğŸ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†</h2>
  <button id="exportTrainersBtn" class="btn" style="margin-bottom: 20px;">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ† Ùˆ Ø¯ÙˆØ±Ø§ØªÙ‡Ù…</button>
  <div style="overflow-x:auto;">
    <table id="trainersTable">
     <thead>
  <tr>
    <th>Ø§Ù„Ø§Ø³Ù…</th>
    <th>Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</th>
    <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
    <th>Ø§Ù„Ø¬ÙˆØ§Ù„</th>
    <th>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</th>
    <th>Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©</th>
    <th>ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
    <th>Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ø¯ÙˆØ±Ø©</th>
    <th>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯ÙˆØ±Ø©</th>
    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
    <th>Ø§Ù„ÙˆÙ‚Øª</th>
    <th>Ø§Ù„Ù…Ø¯Ø©</th>
    <th>Ø§Ù„ØªØµÙ†ÙŠÙ</th>
    <th>Ø§Ù„Ù…ÙƒØ§Ù†</th>
    <th>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</th>
  </tr>
</thead>

      <tbody>
        <!-- ROWS ØªÙØ¶Ø§Ù Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
      </tbody>
    </table>
  </div>
</div>

  </div>

<script>
   const sessionData = JSON.parse(localStorage.getItem("adminSession") || "{}");
  if (!sessionData.timestamp || Date.now() - sessionData.timestamp > 30 * 60 * 1000) {
    localStorage.removeItem("adminSession");
    window.location.href = "login.html";
  }
let landingData = [];

  // Ø¨Ø¹Ø¯ Ù…Ø§ ØªØ¬ÙŠØ¨ sessionData Ù…Ù† localStorage
const perms = {};
(sessionData.powers||'').split(' - ').forEach(p => {
  const [sec, mode] = p.split(':').map(s=>s.trim());
  perms[sec] = mode; // e.g. perms['sec3'] = 'hide' Ø£Ùˆ 'read&write'
});

// Ø¹Ø±Ù‘Ù Ø¯Ø§Ù„Ø© Ù„Ù…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø¹ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¯ÙŠØ§Ù„ÙˆØ¬
function guardClick(e){
  e.stopImmediatePropagation();
  showDialog();
}

// Ø³ÙƒØ´Ù†Ø§Øª Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± (Ø´Ù…Ù„Ù†Ø§ sec6 Ø§Ù„Ø¢Ù†)
['sec1','sec2','sec3','sec4','sec5','sec6'].forEach(id => {
  const li = document.getElementById(id);
  if (!li) return;
  if (perms[id] === 'hide') {
    li.classList.add('disabled');
    li.replaceWith(li.cloneNode(true));
    const newLi = document.getElementById(id);
    newLi.classList.add('disabled');
    newLi.addEventListener('click', guardClick);
  }
});


  document.getElementById('sidebarUser').textContent = "ÙŠØ§ Ù‡Ù„Ø§ ÙÙŠÙƒ " + sessionData.user;

// Ø£ÙˆÙ„Ø§Ù‹ Ø¯Ø§Ù„Ø© ØªØ®ÙÙŠ ÙƒÙ„ Ø§Ù„Ø³ÙƒØ´Ù†Ø§Øª
function hideAllSections() {
  ['dashboardSection','uploadSection','currentSection','trainersSection','staffSection','landingSection']
    .forEach(id => document.getElementById(id).style.display = 'none');
}

// Ø¨Ø¹Ø¯Ù‡Ø§ Ø§Ø±Ø¨Ø· ÙƒÙ„ Ø²Ø± Ø¨Ø§Ù„Ù€ handler Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
document.getElementById('sec1').addEventListener('click', () => {
  hideAllSections();
  document.getElementById('dashboardSection').style.display = 'block';
});
document.getElementById('sec2').addEventListener('click', () => {
  hideAllSections();
  document.getElementById('uploadSection').style.display = 'block';
});
document.getElementById('sec3').addEventListener('click', () => {
  hideAllSections();
  document.getElementById('currentSection').style.display = 'block';
});
document.getElementById('sec4').addEventListener('click', () => {
  hideAllSections();
  document.getElementById('trainersSection').style.display = 'block';
});
document.getElementById('sec5').addEventListener('click', () => {
  hideAllSections();
  document.getElementById('staffSection').style.display = 'block';
});
document.getElementById('sec6').addEventListener('click', () => {
  hideAllSections();
  document.getElementById('landingSection').style.display = 'block'; 
});


  // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBlsY-MMxBz_cc6n8Xz-Z9hB2buun4jszI",
    authDomain: "abbait-4e902.firebaseapp.com",
    databaseURL: "https://abbait-4e902-default-rtdb.firebaseio.com",
    projectId: "abbait-4e902",
    storageBucket: "abbait-4e902.appspot.com",
    messagingSenderId: "12872633784",
    appId: "1:12872633784:web:dc8ff66d9bc6c0eb38134d",
    measurementId: "G-HD6J69MDH4"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();


  let trainersCount = 0;
  let totalPeriods  = 0;
  let busyCount     = 0;
  let coursesCount  = 0;

  let ratioChart, statusChart;

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª
  function updateCharts() {
    // Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ Ø§Ù„Ø£ÙˆÙ„
    if (ratioChart) ratioChart.destroy();
    const ctx1 = document.getElementById('ratioChart').getContext('2d');
    ratioChart = new Chart(ctx1, {
      type: 'pie',
      data: {
        labels: ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØªØ±Ø§Øª', 'Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø©', 'Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†'],
        datasets: [{ data: [totalPeriods, busyCount, trainersCount] }]
      }
    });

    // Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ
    if (statusChart) statusChart.destroy();
    const ctx2 = document.getElementById('statusChart').getContext('2d');
    statusChart = new Chart(ctx2, {
      type: 'pie',
      data: {
        labels: ['Ù…Ø´ØºÙˆÙ„Ø©', 'ØºÙŠØ± Ù…Ø´ØºÙˆÙ„Ø©'],
        datasets: [{ data: [busyCount, totalPeriods - busyCount] }]
      }
    });
  }

  // Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ§Ø­ØªØ³Ø§Ø¨ Ø§Ù„ÙØªØ±Ø§Øª
  db.ref("courses").once("value").then(snap => {
    const data = snap.val() || {};
    coursesCount = Object.keys(data).length;
    totalPeriods = Object.values(data).reduce((sum, course) => {
      const slots = (course.time || "").split(",").map(t => t.trim()).filter(Boolean);
      return sum + slots.length;
    }, 0);
    document.getElementById("coursesCard").innerText = `ğŸ“˜ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØªØ±Ø§Øª: ${totalPeriods}`;
    updateCharts();
  });

  // Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„ÙØªØ±Ø§Øª Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø©
  db.ref("trainees").once("value").then(snap => {
    busyCount = snap.exists() ? Object.keys(snap.val()).length : 0;
    document.getElementById("coursesCardNON").innerText = `ğŸ“– Ø§Ù„ÙØªØ±Ø§Øª Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø©: ${busyCount}`;
    updateCharts();
  });

  // Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†
  db.ref("trainers").once("value").then(snap => {
    trainersCount = snap.exists() ? Object.keys(snap.val()).length : 0;
    document.getElementById("trainersCard").innerText = `ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†: ${busyCount}`;
    updateCharts();
  });

  // Ø±Ø³Ù… Ø¹Ù…ÙˆØ¯ÙŠ ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ† (Ø«Ø§Ù†ÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„Ù†Ø³Ø¨Ø©)
  db.ref("courses").once("value").then(snap => {
    const data = snap.val() || {}, counts = {};
    for (let k in data) {
      counts[data[k].date] = (counts[data[k].date] || 0) + 1;
    }
    const dates = Object.keys(counts).sort();
    new Chart(document.getElementById('coursesChart').getContext('2d'), {
      type: 'bar',
      data: {
        labels: dates,
        datasets: [{
          label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª',
          data: dates.map(d => counts[d])
        }]
      },
      options: { scales: { y: { beginAtZero: true } } }
    });
  });


  // ØªØµØ¯ÙŠØ± Excel Ù…Ø¹ ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ø±Ø³Ù…ÙŠÙ†
  function exportExcel() {
    // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const t = trainersCount;
    const c = coursesCount;
    const table = document.createElement('table');
    table.innerHTML = `
      <tr><th>Ø§Ù„Ù…Ù‚ÙŠØ§Ø³</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr>
      <tr><td>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†</td><td>${t}</td></tr>
      <tr><td>Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª</td><td>${c}</td></tr>
    `;

    // ØµÙˆØ± Ù…Ù† Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³Ø§Øª
    const img1 = document.getElementById('coursesChart').toDataURL('image/png');
    const img2 = document.getElementById('ratioChart').toDataURL('image/png');

    // Ù…Ù„Ù HTML Ø®Ø§Øµ Ø¨Ø§Ù„Ø¥ÙƒØ³Ù„
    const html = `
      <html xmlns:x="urn:schemas-microsoft-com:office:excel">
      <head><meta charset="UTF-8"></head>
      <body>
        ${table.outerHTML}
        <br/>
        <img src="${img1}" />
        <br/>
        <img src="${img2}" />
      </body>
      </html>
    `;
    const uri = 'data:application/vnd.ms-excel;base64,';
    const base64 = s => window.btoa(unescape(encodeURIComponent(s)));
    const link = document.createElement('a');
    link.href = uri + base64(html);
    link.download = 'report.xls';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  function showDialog() {
    const overlay = document.createElement('div');
    overlay.className = 'dialog-overlay';
    overlay.setAttribute('data-dialog', '');
    overlay.innerHTML = `
      <div class="dialog-box">
        <h3 style="color: #e74c3c; margin-bottom: 15px;">ğŸš« Ù…Ø§ ÙŠÙ…Ø¯ÙŠÙƒ ØªØ¯Ø®Ù„</h3>
        <p style="margin-bottom: 20px;">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù„Ø´Ø§Ù† ØªØ¬ÙŠØ¨ ØµÙ„Ø§Ø­ÙŠØ©</p>
        <div class="dialog-actions">
          <button class="btn-submit" onclick="this.closest('[data-dialog]').remove()">Ø­Ø³Ù†Ù‹Ø§</button>
        </div>
      </div>
    `;
    document.body.appendChild(overlay);
  }

  function logout() {
    localStorage.removeItem("adminSession");
    window.location.href = "login.html";
  }

  // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
  document.getElementById('sec5').addEventListener('click', () => {
    document.getElementById('dashboardSection').style.display = 'none';
    document.getElementById('staffSection').style.display = 'block';
    loadUsers();
  });

  function generatePassword() {
    const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+";
    let pass = "";
    while (true) {
      pass = Array(12).fill().map(_ => chars[Math.floor(Math.random() * chars.length)]).join('');
      if (/[A-Z]/.test(pass) && /\d/.test(pass) && /[!@#$%^&*]/.test(pass)) break;
    }
    return pass;
  }
function showAddUserDialog() {
  const overlay = document.createElement('div');
  overlay.className = 'dialog-overlay';
  overlay.setAttribute('data-dialog', '');

  // Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ¹Ù†Ø§ÙˆÙŠÙ†Ù‡Ø§
  const secs = ['sec1','sec2','sec3','sec4','sec5','sec6'];
  const titles = {
    sec1: 'Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª',
    sec2: 'Ø±ÙØ¹ Ø¯ÙˆØ±Ø©',
    sec3: 'Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©',
    sec4: 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†',
    sec5: 'Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†',
    sec6: 'ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ·'
  };

  // ØªÙˆÙ„ÙŠØ¯ ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„: Ø±Ø£Ø³ ÙˆØ¹Ø±Ø¶ ØµÙ„Ø§Ø­ÙŠØ§Øª
  let tbl = '<table style="width:100%;text-align:center;margin:20px 0;"><thead><tr>';
  secs.forEach(s => tbl += `<th>${titles[s]}</th>`);
  tbl += '</tr></thead><tbody>';

  // ØµÙ "Ù‚Ø±Ø§Ø¡Ø© ÙˆÙƒØªØ§Ø¨Ø©"
  tbl += '<tr>';
  secs.forEach(s => {
    tbl += `<td>
      <label><input type="radio" name="power_${s}" value="read&write" checked> Ù‚Ø±Ø§Ø¡Ø© ÙˆÙƒØªØ§Ø¨Ø©</label>
    </td>`;
  });
  tbl += '</tr>';

  // ØµÙ "Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·"
  tbl += '<tr>';
  secs.forEach(s => {
    tbl += `<td>
      <label><input type="radio" name="power_${s}" value="hide">Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø³Ù…</label>
    </td>`;
  });
  tbl += '</tr>';

  tbl += '</tbody></table>';

  // ØµÙØ­Ø© Ø§Ù„Ù€ dialog
  overlay.innerHTML = `
    <div class="dialog-box">
      <h3 style="margin-bottom:20px;">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h3>
      <div class="form-group"><label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
        <input type="text" id="newName" placeholder="Ù…Ø«Ø§Ù„: Ù…ÙˆØ¸Ù Ù‚Ø³Ù… Ø§Ù„ØªØ¯Ø±ÙŠØ¨">
      </div>
      <div class="form-group"><label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
        <select id="newType">
          <option value="employee">Ù…ÙˆØ¸Ù</option>
          <option value="admin">Ù…Ø¯ÙŠØ±</option>
        </select>
      </div>
      <div class="form-group"><label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (ØªØªÙˆÙ„Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§)</label>
        <input type="text" id="newPassword" value="${generatePassword()}" disabled>
      </div>
      <div><strong>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</strong>${tbl}</div>
      <div class="dialog-actions">
        <button class="btn-submit" onclick="saveUser(document.getElementById('newPassword').value)">Ø­ÙØ¸</button>
        <button class="btn-close" onclick="this.closest('[data-dialog]').remove()">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  `;
  document.body.appendChild(overlay);
}


function saveUser(password) {
  const name = document.getElementById('newName').value.trim();
  const type = document.getElementById('newType').value;

  // Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…:
  const secs = ['sec1','sec2','sec3','sec4','sec5','sec6'];
  const pws = [];

  secs.forEach(s => {
    // Ø§Ù„Ø¢Ù† ÙŠØ¨Ø­Ø« Ø¹Ù† name="power_sec1" ÙˆÙ‡ÙƒØ°Ø§
    const val = document.querySelector(`input[name="power_${s}"]:checked`);
    if (val) pws.push(`${s}: ${val.value}`);
  });

  if (!name || pws.length !== secs.length) {
    return alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ø®ØªÙŠØ§Ø± ØµÙ„Ø§Ø­ÙŠØ§Øª");
  }

  const id = 'user_' + Date.now();
  db.ref("users/" + id).set({
    name,
    type,
    password,
    powers: pws.join(" - ")
  })
  .then(() => {
    alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¸Ù!");
    document.querySelector('[data-dialog]').remove();
    loadUsers();
  });
}


function loadUsers() {
  db.ref("users").once("value").then(snap => {
    const users = snap.val() || {};
    const cont = document.getElementById("usersContainer");
    cont.innerHTML = '';

    const mapName = {
      sec1:'Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª',
      sec2:'Ø±ÙØ¹ Ø¯ÙˆØ±Ø©',
      sec3:'Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©',
      sec4:'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†',
      sec5:'Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ùˆ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª',
      sec6:'ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ·'
    };

    Object.entries(users).forEach(([id, u]) => {
      let displayPerms;
   

      cont.insertAdjacentHTML('beforeend', `
        <div class="staff-card">
          <div>
            <strong>${u.name}</strong><br/>
            ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: <span>${u.password}</span>
            <button onclick="navigator.clipboard.writeText('${u.password}')">ğŸ“‹</button><br/>
            Ø§Ù„Ù†ÙˆØ¹: <strong>${u.type==='admin'?'Ù…Ø¯ÙŠØ±':'Ù…ÙˆØ¸Ù'}</strong><br/>
            Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª: ${displayPerms || 'â€”'}
          </div>
          <div>
            <button onclick="editUser('${id}')">âœï¸</button>
            <button onclick="confirmDeleteUser('${id}')">ğŸ—‘ï¸</button>
          </div>
        </div>
      `);
    });

    if (!Object.keys(users).length) {
      cont.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ†.';
    }
  });
}



  function confirmDeleteUser(id) {
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸ÙØŸ")) {
      db.ref("users/" + id).remove();
      loadUsers();
    }
  }





  function confirmPasswordReset(id) {
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªÙˆÙ„ÙŠØ¯ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©ØŸ")) {
      const newP = generatePassword();
      db.ref("users/" + id + "/password").set(newP);
      alert("âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©!");
      document.getElementById('editPassword').value = newP;
    }
  }

  function saveEdit(id) {
    const name = document.getElementById('editName').value.trim();
    const type = document.getElementById('editType').value;
    let pws = '';
    ['sec1','sec2','sec3','sec4','sec5','sec6'].forEach(s => {
      const sel = document.querySelector(`input[name="power_${s}"]:checked`);
      pws += `${s}: ${sel ? sel.value : 'hide'} - `;
    });
    pws = pws.replace(/- $/, '');
    db.ref("users/" + id).update({ name, type, powers: pws })
      .then(() => {
        alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸!");
        document.querySelector('[data-dialog]').remove();
        loadUsers();
      });
  }
document.getElementById('sec2').addEventListener('click', () => {
    document.getElementById('dashboardSection').style.display = 'none';
    document.getElementById('staffSection').style.display = 'none';
    document.getElementById('uploadSection').style.display = 'block';
  });

 
  

  // Ø¥Ø¹Ø¯Ø§Ø¯ ØªØ¹Ø¯Ø¯ Ø§Ù„ÙØªØ±Ø§Øª
  const multiCheckbox = document.getElementById('courseMulti');
  const slotsCountInput = document.getElementById('slotsCount');
  const slotsContainer = document.getElementById('slotsContainer');
  const datesContainer  = document.getElementById('datesContainer');
const mainDateInput   = document.getElementById('courseDate');
slotsContainer.innerHTML = singleSlotMarkup(1);
// Ø¯Ø§Ù„Ø© ØªØ±Ø¬Ø¹ Ø§Ù„Ù€ HTML Ù„Ø¨ÙˆÙƒØ³ ÙØªØ±Ø© Ø±Ù‚Ù… idx
function singleSlotMarkup(idx) {
  return `
    <div class="slot-group">
      <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØªØ±Ø© ${idx}</label>
      <input type="date" class="slotDate" required>
      <label>Ø§Ù„ÙˆÙ‚Øª ${idx}</label>
      <input type="time" class="slotTime" required>
      <label>Ø§Ù„Ù…Ø¯Ø© ${idx}</label>
      <input type="text" class="slotDuration" placeholder="Ù…Ø«Ø§Ù„: Ø³Ø§Ø¹ØªÙŠÙ†" required>
    </div>`;
}

// Ù„Ù…Ø§ ÙŠØªØºÙŠØ± Ø§Ù„ØªØ´ÙŠÙƒ Ø¨ÙˆÙƒØ³
multiCheckbox.addEventListener('change', () => {
  slotsCountInput.style.display = multiCheckbox.checked ? 'inline-block' : 'none';
  // Ù„Ùˆ Ø±Ø¬Ø¹Ù†Ø§ Ù„ÙØªØ±Ø© ÙˆØ§Ø­Ø¯Ø©
  if (!multiCheckbox.checked) {
    slotsContainer.innerHTML = singleSlotMarkup(1);
  }
});

// Ù„Ù…Ø§ ÙŠØ¯Ø®Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø¯Ø¯ Ø§Ù„ÙØªØ±Ø§Øª
slotsCountInput.addEventListener('input', () => {
  const n = parseInt(slotsCountInput.value) || 1;
  slotsContainer.innerHTML = '';
  for (let i = 1; i <= n; i++) {
    slotsContainer.innerHTML += singleSlotMarkup(i);
  }
});



multiCheckbox.addEventListener('change', () => {
  slotsCountInput.style.display = multiCheckbox.checked ? 'inline-block' : 'none';
  if (!multiCheckbox.checked) {
    slotsContainer.innerHTML = document.querySelector('.slot-group').outerHTML;
    datesContainer.innerHTML   = '';
  }
});

// Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø¹Ø¯Ø¯ Ø§Ù„ÙØªØ±Ø§Øª
slotsCountInput.addEventListener('input', () => {
  const n = parseInt(slotsCountInput.value) || 1;

  // Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ù…Ø¯Ø©
  slotsContainer.innerHTML = '';
  for (let i = 0; i < n; i++) {
    slotsContainer.innerHTML += `
      <div class="slot-group">
        <label>Ø§Ù„ÙˆÙ‚Øª ${i+1}</label>
        <input type="time" class="slotTime" required>
        <label>Ø§Ù„Ù…Ø¯Ø© ${i+1}</label>
        <input type="text" class="slotDuration" placeholder="Ù…Ø«Ø§Ù„: Ø³Ø§Ø¹ØªÙŠÙ†" required>
      </div>`;
  }

  // Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
  datesContainer.innerHTML = '';
  for (let i = 0; i < n; i++) {
    datesContainer.innerHTML += `
      <div class="form-group">
        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØªØ±Ø© ${i+1}</label>
        <input type="date" class="slotDate" required>
      </div>`;
  }
});
  multiCheckbox.addEventListener('change', () => {
    slotsCountInput.style.display = multiCheckbox.checked ? 'inline-block' : 'none';
    if (!multiCheckbox.checked) {
      slotsContainer.innerHTML = document.querySelector('.slot-group').outerHTML;
    }
  });
  slotsCountInput.addEventListener('input', () => {
    const n = parseInt(slotsCountInput.value) || 1;
    slotsContainer.innerHTML = '';
    for (let i = 0; i < n; i++) {
      slotsContainer.innerHTML += `
        <div class="slot-group">
          <label>Ø§Ù„ÙˆÙ‚Øª ${i+1}</label>
          <input type="time" class="slotTime" required>
          <label>Ø§Ù„Ù…Ø¯Ø© ${i+1}</label>
          <input type="text" class="slotDuration" placeholder="Ù…Ø«Ø§Ù„: Ø³Ø§Ø¹ØªÙŠÙ†" required>
        </div>`;
    }
  });

  // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  document.getElementById('uploadForm').addEventListener('submit', e => {
    e.preventDefault();
    const title    = document.getElementById('courseTitle').value.trim();
    const desc     = document.getElementById('courseDesc').value.trim();
    const date = Array.from(document.querySelectorAll('.slotDate')).map(i => i.value.trim()).join(',');
    const times    = Array.from(document.querySelectorAll('.slotTime')).map(i => i.value);
    const durations= Array.from(document.querySelectorAll('.slotDuration')).map(i => i.value.trim());
    const category = document.getElementById('courseCategory').value.trim();
    const place    = document.getElementById('coursePlace').value.trim();
    const target   = document.getElementById('courseTarget').value.trim();
    const multi    = multiCheckbox.checked;
    
    // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
    if (!title||!desc||!date||times.some(t=>!t)||durations.some(d=>!d)||!category||!place||!target) {
      return alert('Ø±Ø¬Ø§Ø¡Ù‹ Ø¹Ø¨Ù‘ÙŠ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„');
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ ÙƒØ§Ø¦Ù† Ø§Ù„Ø¯ÙˆØ±Ø© Ù…Ø¹ image ÙØ§Ø±Øº
    const course = { title, description: desc, date, time: times.join(','), duration: durations.join(','), category, place, target, image: "", multiSlots: multi };

    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    firebase.database().ref('courses').push(course)
      .then(() => {
        alert('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¯ÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!');
        document.getElementById('uploadForm').reset();
        slotsContainer.innerHTML = document.querySelector('.slot-group').outerHTML;
      })
      .catch(err => alert('âŒ Ø®Ø·Ø£: ' + err.message));
  });

 // Ù…Ø³ØªÙ…Ø¹ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
  document.getElementById('sec3').addEventListener('click', () => {
    ['dashboardSection','staffSection','uploadSection'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.display = 'none';
    });
    document.getElementById('currentSection').style.display = 'block';
    loadCurrentCourses();
  });

  // Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù…Ù† Firebase
  function loadCurrentCourses() {
    const container = document.getElementById('currentContainer');
    container.innerHTML = '';
    firebase.database().ref('courses').once('value').then(snapshot => {
      const data = snapshot.val() || {};
      Object.entries(data).forEach(([id, course]) => {
        const imgSrc = course.image && course.image.trim() !== '' ? course.image : 'default-image.svg';
        container.insertAdjacentHTML('beforeend', `
          <div class="course-card">
            <img src="${imgSrc}" onerror="this.onerror=null;this.src='default-image.svg';" alt="${course.title}" />
            <div class="course-info">
              <h3>${course.title}</h3>
              <p>${course.description}</p>
              <p>ğŸ“… ${course.date}</p>
              <p>â° ${course.time}</p>
              <p>â³ ${course.duration}</p>
              <p>ğŸ·ï¸ ${course.category}</p>
              <p>ğŸ“ ${course.place}</p>
              <p>ğŸ‘¥ ${course.target}</p>
            </div>
            <div class="course-actions">
              <button onclick="editCourse('${id}')" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</button>
              <button onclick="deleteCourse('${id}')" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
            </div>
          </div>
        `);
      });
    });
  }

  // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù
  let currentEditId = null;
 // 1) Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø­ÙˆØ§Ø± ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø©
function editCourse(id) {
  currentEditId = id;
  firebase.database().ref('courses/' + id).once('value').then(snapshot => {
    const c = snapshot.val();

    // ÙÙƒ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®/Ø§Ù„Ø£ÙˆÙ‚Ø§Øª/Ø§Ù„Ù…Ø¯Ø¯ Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ§Øª
    const datesArr    = (c.date     || '').split(',').map(s=>s.trim());
    const timesArr    = (c.time     || '').split(',').map(s=>s.trim());
    const durArr      = (c.duration || '').split(',').map(s=>s.trim());
    const slotCount   = datesArr.length;

    // Ø¨Ù†Ø§Ø¡ Ø­Ù‚ÙˆÙ„ ÙƒÙ„ ÙØªØ±Ø©
    let slotsHtml = '';
    for (let i = 0; i < slotCount; i++) {
      slotsHtml += `
        <div class="form-group">
          <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØªØ±Ø© ${i+1}</label>
          <input type="date" id="d_date_${i}" value="${datesArr[i]||''}" required />
        </div>
        <div class="form-group">
          <label>Ø§Ù„ÙˆÙ‚Øª ${i+1}</label>
          <input type="time" id="d_time_${i}" value="${timesArr[i]||''}" required />
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ù…Ø¯Ø© ${i+1}</label>
          <input type="text" id="d_duration_${i}" value="${durArr[i]||''}" placeholder="Ù…Ø«Ø§Ù„: Ø³Ø§Ø¹ØªÙŠÙ†" required />
        </div>
      `;
    }

    // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù€ dialog ÙƒØ§Ù…Ù„
    const overlay = document.createElement('div');
    overlay.className = 'dialog-overlay';
    overlay.setAttribute('data-dialog', '');
    overlay.innerHTML = `
      <div class="dialog-box">
        <h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø©</h3>
        <div class="form-group">
          <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
          <input type="text" id="d_title" value="${c.title||''}" required />
        </div>
        <div class="form-group">
          <label>Ø§Ù„ÙˆØµÙ</label>
          <textarea id="d_desc" required>${c.description||''}</textarea>
        </div>
        ${slotsHtml}
        <div class="form-group">
          <label>Ø§Ù„ØªØµÙ†ÙŠÙ</label>
          <input type="text" id="d_category" value="${c.category||''}" required />
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ù…ÙƒØ§Ù†</label>
          <input type="text" id="d_place" value="${c.place||''}" required />
        </div>
        <div class="form-group">
          <label>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</label>
          <input type="text" id="d_target" value="${c.target||''}" required />
        </div>
        <div class="dialog-actions">
          <button class="btn-submit" onclick="saveEditCourse(${slotCount})">Ø­ÙØ¸</button>
          <button class="btn-close" onclick="this.closest('[data-dialog]').remove()">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
    `;
    document.body.appendChild(overlay);
  });
}

// 2) Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
function saveEditCourse(slotCount) {
  // Ø¬Ù…Ø¹ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø¹Ø¯Ù‘Ù„Ø©
  const updates = {
    title:       document.getElementById('d_title').value.trim(),
    description: document.getElementById('d_desc').value.trim(),
    category:    document.getElementById('d_category').value.trim(),
    place:       document.getElementById('d_place').value.trim(),
    target:      document.getElementById('d_target').value.trim(),
  };

  // Ø¬Ù…Ø¹ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®/Ø§Ù„Ø£ÙˆÙ‚Ø§Øª/Ø§Ù„Ù…Ø¯Ø¯ Ù„ÙƒÙ„ ÙØªØ±Ø©
  const newDates = [];
  const newTimes = [];
  const newDurs  = [];
  for (let i = 0; i < slotCount; i++) {
    newDates.push   (document.getElementById(`d_date_${i}`).value);
    newTimes.push   (document.getElementById(`d_time_${i}`).value);
    newDurs .push   (document.getElementById(`d_duration_${i}`).value.trim());
  }
  updates.date     = newDates.join(',');
  updates.time     = newTimes.join(',');
  updates.duration = newDurs.join(',');

  // Ø­ÙØ¸Ù‡Ø§ ÙÙŠ Firebase
  firebase.database().ref('courses/' + currentEditId).update(updates)
    .then(() => {
      document.querySelector('[data-dialog]').remove();
      loadCurrentCourses();
      alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª');
    })
    .catch(err => alert('âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: ' + err.message));
}

 
 
 
 
 
function deleteCourse(courseId) {
  if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆØ±Ø©ØŸ')) return;

  const traineesRef = firebase.database().ref('trainees');

  // Ø£ÙˆÙ„ Ø´ÙŠ Ù†Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† Ø§Ù„Ù„ÙŠ Ù…Ø³Ø¬Ù„ÙŠÙ† ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø¯ÙˆØ±Ø©
  traineesRef.once('value', (snapshot) => {
    snapshot.forEach((child) => {
      const trainee = child.val();
      if (trainee.courseId === courseId) {
        firebase.database().ref('trainees/' + child.key).remove();
        console.log("ØªÙ… Ø­Ø°Ù Ù…Ø¯Ø±Ø¨:", child.key);
      }
    });

    // Ø¨Ø¹Ø¯ Ù…Ø§ Ù†Ø®Ù„Øµ Ù†Ø­Ø°Ù Ø§Ù„Ø¯ÙˆØ±Ø© Ù†ÙØ³Ù‡Ø§
    firebase.database().ref('courses/' + courseId).remove().then(() => {
      console.log("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙˆØ±Ø©:", courseId);
      loadCurrentCourses();
    });
  });
}


  // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

// 2) Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase ÙˆØ¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
let trainersData = [];  // Ù†Ø®Ø²Ù†Ù‡Ø§ Ù„Ù„ØªØµØ¯ÙŠØ±

function loadTrainees() {
  // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ØµÙÙˆÙØ© ÙÙŠ ÙƒÙ„ Ù…Ø±Ø©
  trainersData = [];

  const tbody = document.querySelector('#trainersTable tbody');
  tbody.innerHTML = '';

  firebase.database().ref('trainees').once('value').then(snapshot => {
    const data = snapshot.val() || {};

    Object.entries(data).forEach(([key, t]) => {
      // Ø®Ø²Ù† Ø§Ù„Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„Ù…ØµÙÙˆÙØ© Ù„ÙŠØªÙ… ØªØµØ¯ÙŠØ±Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
      trainersData.push(t);

      // Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙŠØ±Ø© Ø£Ùˆ Ø²Ø± ØºÙŠØ± Ù…Ø±ÙÙˆØ¹
      const cvBtn = t.cvUrl && t.cvUrl.trim()
        ? `<button class="btn" onclick="window.open('${t.cvUrl}', '_blank')">Ø¹Ø±Ø¶</button>`
        : `<button class="btn disabled">ØºÙŠØ± Ù…Ø±ÙÙˆØ¹</button>`;

      // Ø£Ø¶Ù ØµÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„
      tbody.insertAdjacentHTML('beforeend', `
        <tr>
          <td>${t.name}</td>
          <td>${t.workname || ''}</td>
          <td>${t.email}</td>
          <td>${t.phone}</td>
          <td>${t.nationalId}</td>
          <td>${cvBtn}</td>
          <td>${new Date(t.registeredAt).toLocaleString('ar-EG')}</td>
          <td>${t.courseId}</td>
          <td>${t.courseTitle}</td>
          <td>${t.date}</td>
          <td>${t.time}</td>
          <td>${t.duration}</td>
          <td>${t.category}</td>
          <td>${t.place}</td>
          <td>${t.target}</td>
          <td><button class="btn" onclick="editTrainer('${key}')">âœï¸</button></td>
          <td><button class="btn" onclick="deleteTrainer('${key}')">ğŸ—‘ï¸</button></td>
        </tr>
      `);
    });

    // Ø¥Ø°Ø§ Ù…Ø§ ÙÙŠÙ‡ Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø£Ø¸Ù‡Ø± Ø±Ø³Ø§Ù„Ø©
    if (trainersData.length === 0) {
      tbody.innerHTML = `
        <tr>
          <td colspan="17">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¯Ø±Ø¨ÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ†</td>
        </tr>
      `;
    }
  });
}

// ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ loadTrainees() Ø¹Ù†Ø¯ ÙØªØ­ ØªØ¨ÙˆÙŠØ¨ "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†"
document.getElementById('sec4').addEventListener('click', () => {
  hideAllSections();
  document.getElementById('trainersSection').style.display = 'block';
  loadTrainees();
});

// -------------------
// 2) Ø¯Ø§Ù„ØªØ§ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù
// -------------------
let currentTrainerKey = null;

function editTrainer(key) {
  currentTrainerKey = key;
  firebase.database().ref('trainees/' + key).once('value').then(snapshot => {
    const t = snapshot.val();
    const overlay = document.createElement('div');
    overlay.className = 'dialog-overlay';
    overlay.innerHTML = `
      <div class="dialog-box">
        <h3>ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø¨</h3>
        <div class="form-group"><label>Ø§Ù„Ø§Ø³Ù…</label><input type="text" id="tr_name" value="${t.name}"></div>
        <div class="form-group"><label>Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label><input type="text" id="tr_workname" value="${t.workname || ''}"></div>
        <div class="form-group"><label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label><input type="email" id="tr_email" value="${t.email}"></div>
        <div class="form-group"><label>Ø§Ù„Ø¬ÙˆØ§Ù„</label><input type="text" id="tr_phone" value="${t.phone}"></div>
        <div class="form-group"><label>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© (ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)</label><input type="text" id="tr_nid" value="${t.nationalId}" disabled></div>
        <div class="form-group"><label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input type="text" id="tr_date" value="${t.date}"></div>
        <div class="form-group"><label>Ø§Ù„ÙˆÙ‚Øª</label><input type="text" id="tr_time" value="${t.time}"></div>
        <div class="dialog-actions">
          <button class="btn-submit" onclick="saveTrainerEdit()">Ø­ÙØ¸</button>
<button class="btn-close" onclick="this.closest('.dialog-overlay').remove()">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
    `;
    document.body.appendChild(overlay);
  });
}

function saveTrainerEdit() {
  const upd = {
    name: document.getElementById('tr_name').value.trim(),
    workname: document.getElementById('tr_workname').value.trim(),
    email: document.getElementById('tr_email').value.trim(),
    phone: document.getElementById('tr_phone').value.trim(),
    date: document.getElementById('tr_date').value.trim(),
    time: document.getElementById('tr_time').value.trim()
  };
  firebase.database().ref('trainees/' + currentTrainerKey).update(upd)
    .then(() => {
      alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
      document.querySelector('.dialog-overlay').remove();
      loadTrainees();
    })
    .catch(err => alert('âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: ' + err.message));
}

function deleteTrainer(key) {
  if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¯Ø±Ø¨ØŸ')) return;
  firebase.database().ref('trainees/' + key).remove()
    .then(() => loadTrainees());
}

// ÙÙŠ Ù†Ù‡Ø§ÙŠØ© <script> Ù„Ø¯ÙŠÙƒØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ loadTrainees() Ø¹Ù†Ø¯ Ø¯Ø®ÙˆÙ„ ØªØ¨ÙˆÙŠØ¨ "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†":



// 3) Ø²Ø± ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ CSV
document.getElementById('exportTrainersBtn').addEventListener('click', exportTrainers);



async function exportTrainers() {
  if (!trainersData.length) return alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
  const dateTag = new Date().toISOString().slice(0,10);
  const zip = new JSZip();

  // 1) ØªØ­Ø¶ÙŠØ± Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„
  const workbook = new ExcelJS.Workbook();
  workbook.creator = 'Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù';
  workbook.created = new Date();
  const sheet = workbook.addWorksheet('Trainers');

  const headers = [
    'Ø§Ù„Ø§Ø³Ù…','Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ','Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ','Ø§Ù„Ø¬ÙˆØ§Ù„','Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©',
    'ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„','Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ø¯ÙˆØ±Ø©','Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯ÙˆØ±Ø©','Ø§Ù„ØªØ§Ø±ÙŠØ®','Ø§Ù„ÙˆÙ‚Øª',
    'Ø§Ù„Ù…Ø¯Ø©','Ø§Ù„ØªØµÙ†ÙŠÙ','Ø§Ù„Ù…ÙƒØ§Ù†','Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©'
  ];
  sheet.addRow(headers).font = { bold:true };

  trainersData.forEach(t => {
    sheet.addRow([
      t.name,
      t.workname || '',
      t.email,
      t.phone,
      t.nationalId,
      new Date(t.registeredAt).toLocaleString('ar-EG'),
      t.courseId,
      t.courseTitle,
      t.date,
      t.time,
      t.duration,
      t.category,
      t.place,
      t.target
    ]);
  });

  // Ø¶Ø¨Ø· Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„
  sheet.columns.forEach(col => {
    let max = 10;
    col.eachCell({ includeEmpty:true }, cell => {
      const l = (cell.value||'').toString().length;
      if (l>max) max=l;
    });
    col.width = max + 2;
  });

  // 2) Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„ Ù„Ù„Ù€ ZIP
  const excelBuffer = await workbook.xlsx.writeBuffer();
  zip.file(`Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†_${dateTag}.xlsx`, excelBuffer);

  // 3) Ø¥Ø¶Ø§ÙØ© ÙƒÙ„ Ù…Ù„ÙØ§Øª Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©
  for (const t of trainersData) {
    if (t.cvUrl) {
      try {
        const resp = await fetch(t.cvUrl);
        const blob = await resp.blob();
        const arrBuf = await blob.arrayBuffer();
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ù…ØªØ¯Ø§Ø¯ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
        const ext = t.cvUrl.split('.').pop().split('?')[0];
        const safeName = t.name.replace(/\s+/g,'_');
        zip.file(`${safeName}_${t.courseId}.${ext}`, arrBuf);
      } catch(err) {
        console.warn('ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø³ÙŠØ±Ø© Ù„Ù€', t.name, err);
      }
    }
  }

  // 4) ØªÙˆÙ„ÙŠØ¯ ÙˆØªÙ†Ø²ÙŠÙ„ ZIP
  const zipBlob = await zip.generateAsync({ type:'blob' });
  const url = URL.createObjectURL(zipBlob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `trainers_bundle_${dateTag}.zip`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}



  // helper to hide all sections
  function hideAllSections() {
    ['dashboardSection','staffSection','uploadSection','currentSection','trainersSection','landingSection']
      .forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
      });
  }

  // when "ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ·" tab is clicked
  document.getElementById('sec6').addEventListener('click', () => {
    hideAllSections();
    document.getElementById('landingSection').style.display = 'block';
     loadLandingLinks();
    loadLandingMessages();
  });

  function showMessageDialog(msg) {
  const overlay = document.createElement('div');
  overlay.className = 'dialog-overlay';
  overlay.innerHTML = `
    <div class="dialog-box large">
      <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</h3>
      <div class="dialog-content">
        <p>${msg}</p>
      </div>
      <div class="dialog-actions">
        <button class="btn-submit" onclick="this.closest('.dialog-overlay').remove()">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  `;
  document.body.appendChild(overlay);
}

// Ø¬Ù„Ø¨ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù…Ù† Firebase ÙˆØ¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„
function loadLandingLinks() {
  db.ref('siteLinks').once('value').then(snap => {
    const data = snap.val() || {};
    document.getElementById('heroContactLinkInput').value = data.heroContactLink || '';
    document.getElementById('registerLinkInput').value   = data.registerLink   || '';
  });
}

// Ø­ÙØ¸ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
document.getElementById('saveLandingLinksBtn').addEventListener('click', () => {
  const heroLink     = document.getElementById('heroContactLinkInput').value.trim();
  const registerLink = document.getElementById('registerLinkInput').value.trim();
  db.ref('siteLinks').set({ heroContactLink: heroLink, registerLink: registerLink })
    .then(() => alert('âœ… ØªÙ… Ø­ÙØ¸ Ø±ÙˆØ§Ø¨Ø· ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ·!'))
    .catch(err => alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸: ' + err.message));
});

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ø¹ Ø²Ø± Ø§Ù„Ø¹Ø±Ø¶
  function loadLandingMessages() {
    const tbody = document.querySelector('#landingTable tbody');
    tbody.innerHTML = '';
    db.ref('contactMessages').once('value').then(snap => {
      const msgs = snap.val() || {};
      landingData = [];
       Object.values(msgs).reverse().forEach(msg => {
        landingData.push(msg);
        // Ø²Ø± â€œØ¹Ø±Ø¶â€ Ø¯Ø§Ø®Ù„ Ø®Ù„ÙŠØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        tbody.insertAdjacentHTML('beforeend', `
          <tr>
            <td>${msg.name}</td>
            <td>${msg.email}</td>
            <td>${msg.city}</td>
            <td>${msg.dateTime}</td>
            <td>${msg.day}</td>
            <td>${msg.browser}</td>
            <td>${msg.device}</td>
            <td>
              <button class="btn" data-msg="${encodeURIComponent(msg.message)}">Ø¹Ø±Ø¶</button>
            </td>
          </tr>
        `);
      });

      // Ø±Ø¨Ø· Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ù„ÙƒÙ„ Ø²Ø±
      tbody.querySelectorAll('button[data-msg]').forEach(btn => {
        btn.addEventListener('click', () => {
          const text = decodeURIComponent(btn.getAttribute('data-msg'));
          showMessageDialog(text);
        });
      });
    });
  }

  // Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ landingDataØŒ Ù†ØµØ¯Ø±Ù‡Ø§ Ø¥Ù„Ù‰ Ø¥ÙƒØ³Ù„
document.getElementById('exportLandingBtn').addEventListener('click', async () => {
  if (!landingData || !landingData.length) {
    return alert('Ù…Ø§ ÙÙŠÙ‡ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
  }

  // 1) Ø£Ù†Ø´Ø¦ Workbook Ùˆ Worksheet
  const workbook = new ExcelJS.Workbook();
  workbook.creator = 'Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù';
  workbook.created = new Date();
  const sheet = workbook.addWorksheet('Landing Messages');

  // 2) Ø£Ø¶Ù Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
  sheet.addRow([
    'Ø§Ù„Ø§Ø³Ù…',
    'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
    'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©',
    'Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª',
    'Ø§Ù„ÙŠÙˆÙ…',
    'Ø§Ù„Ù…ØªØµÙØ­',
    'Ø§Ù„Ø¬Ù‡Ø§Ø²',
    'Ø§Ù„Ø±Ø³Ø§Ù„Ø©'
  ]).font = { bold: true };

  // 3) Ø£Ø¶Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  landingData.forEach(msg => {
    sheet.addRow([
      msg.name,
      msg.email,
      msg.city,
      msg.dateTime,
      msg.day,
      msg.browser,
      msg.device,
      msg.message
    ]);
  });

  // 4) Ø¶Ø¨Ø· Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
  sheet.columns.forEach(col => {
    let max = 10;
    col.eachCell({ includeEmpty: true }, cell => {
      const len = (cell.value || '').toString().length;
      if (len > max) max = len;
    });
    col.width = max + 2;
  });

  // 5) ØªÙˆÙ„ÙŠØ¯ Ù…Ù„Ù Ø§Ù„Ù€ XLSX ÙˆØªÙ†Ø²ÙŠÙ„Ù‡
  const buf = await workbook.xlsx.writeBuffer();
  const blob = new Blob([buf], {
    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
  });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `landing_messages_${new Date().toISOString().slice(0,10)}.xlsx`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});

</script>
</body>
</html>